# pbx-scheduler-paging — طراحی و تصمیم‌های کلیدی

هدف
ایجاد ماژول پیجینگ برای Issabel 5 که داخل پنل ماژول‌های Issabel نمایش داده شود و امکانات زیر را فراهم کند:
- گروه‌بندی داخلی‌های chan_sip به صورت zone و اختصاص دادن داخلی‌ها به zoneها.
- آپلود فایل صوتی با هر فرمت، تبدیل با ffmpeg به فرمت مناسب Asterisk و ذخیرهٔ متادیتا (duration, size).
- ساخت لیست پخش (playlist) و امکان زمانبندی اجرای لیست پخش روی zoneها (روزهای هفته، تاریخ خاص، بازه زمانی).
- پخش اذان بر اساس زمان‌های شرعی شهر انتخاب‌شده و پخش صوت قبل و بعد از اذان به صورت هماهنگ.
- پیجینگ دستی (live paging) توسط اپراتور: اپراتور با تلفن می‌تواند پیجینگ صوتی زنده به zone را آغاز کند (فقط کاربرانِ مجاز).
- داشبورد مدیریتی وضعیت داخلی‌ها (آنلاین/آفلاین/درحال پخش) و وضعیت زمانبندی‌های جاری.
- لاگ کامل رویدادها و خطاها.

معماری انتخاب‌شده
- UI Module: PHP داخل Issabel (نمایش در پنل ماژول‌ها). مدیریت zone، endpoints، playlists، schedules، operators و logs.
- Backend Service: Python (daemon) که روی همان سرور Issabel اجرا می‌شود. مسئول:
  - پردازش فایل‌های آپلودی و تبدیل با ffmpeg
  - ارتباط با Asterisk AMI برای Originate/Playback و مانیتورینگ
  - زمانبندی (scheduler loop) و مدیریت اجرای playlistها
  - محاسبه اوقات شرعی با کتابخانه مناسب (مثلاً astral)
  - نوشتن لاگ‌ها و ثبت audit
- دیتابیس: MariaDB (همان DB Issabel یا دیتابیس جداگانه) برای نگهداری متادیتا.
- ذخیره فایل: /var/lib/pbx-scheduler-paging/media

ملاحظات کلیدی
- chan_sip استفاده می‌شود.
- اجرای همه سرویس‌ها روی همان سرور Issabel.
- احراز هویت و مجوزها: اپراتورها داخل جدول operators تعریف می‌شوند و فقط اپراتورهای مجاز می‌توانند پیجینگ دستی را شروع کنند.
- اعلان‌های دیسک: فقط در صورت پر شدن دیسک پیام هشدار تولید شود.
